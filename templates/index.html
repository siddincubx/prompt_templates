{% extends "base.html" %}

{% block title %}Home - Prompt Template Engine{% endblock %}

{% block content %}
<div class="hero min-h-[60vh] bg-gradient-to-r from-primary to-secondary text-primary-content rounded-lg mb-8">
    <div class="hero-content text-center">
        <div class="max-w-md">
            <h1 class="mb-5 text-5xl font-bold">
                <i class="fas fa-magic mr-3"></i>
                Prompt Engine
            </h1>
            <p class="mb-5 text-lg">
                Create, manage, and reuse prompt templates with AI assistance. 
                Transform your ideas into powerful prompts with variable support.
            </p>
            <div class="flex gap-4 justify-center">
                <a href="/templates/create" class="btn btn-accent btn-lg">
                    <i class="fas fa-plus mr-2"></i>
                    Create Template
                </a>
                <a href="/templates" class="btn btn-outline btn-lg">
                    <i class="fas fa-list mr-2"></i>
                    Browse Templates
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Statistics Section -->
<section class="mb-8">
    <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-base-content mb-2">
            <i class="fas fa-chart-bar mr-3 text-primary"></i>
            Platform Statistics
        </h2>
        <p class="text-base-content/70">Real-time insights into your template ecosystem</p>
    </div>
    
    <!-- Loading State -->
    <div id="stats-loading" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <div class="stats-card-skeleton">
            <div class="skeleton-icon"></div>
            <div class="skeleton-value"></div>
            <div class="skeleton-label"></div>
        </div>
        <div class="stats-card-skeleton">
            <div class="skeleton-icon"></div>
            <div class="skeleton-value"></div>
            <div class="skeleton-label"></div>
        </div>
        <div class="stats-card-skeleton">
            <div class="skeleton-icon"></div>
            <div class="skeleton-value"></div>
            <div class="skeleton-label"></div>
        </div>
        <div class="stats-card-skeleton">
            <div class="skeleton-icon"></div>
            <div class="skeleton-value"></div>
            <div class="skeleton-label"></div>
        </div>
    </div>
    
    <!-- Stats Content -->
    <div id="stats-container" 
         class="hidden grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6"
         hx-get="/api/stats/html" 
         hx-trigger="load" 
         hx-target="#stats-container"
         hx-swap="innerHTML">
        <!-- Dynamic stats will load here -->
    </div>

</section>

<!-- Quick Actions -->
<div class="mt-8">
    <h2 class="text-2xl font-bold mb-4 text-center">Quick Actions</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- AI Generate -->
        <div class="card bg-gradient-to-br from-purple-500 to-pink-500 text-white shadow-xl">
            <div class="card-body text-center">
                <i class="fas fa-robot text-4xl mb-3"></i>
                <h3 class="card-title justify-center">AI Generate</h3>
                <p>Let AI create a template for you based on your requirements</p>
                <div class="card-actions justify-center mt-4">
                    <a href="/templates/create" class="btn btn-ghost text-white border-white hover:bg-white hover:text-purple-500">
                        Generate Now
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Browse & Use -->
        <div class="card bg-gradient-to-br from-blue-500 to-cyan-500 text-white shadow-xl">
            <div class="card-body text-center">
                <i class="fas fa-search text-4xl mb-3"></i>
                <h3 class="card-title justify-center">Browse & Use</h3>
                <p>Explore existing templates and use them with your own data</p>
                <div class="card-actions justify-center mt-4">
                    <a href="/templates" class="btn btn-ghost text-white border-white hover:bg-white hover:text-blue-500">
                        Browse Now
                    </a>
                </div>
            </div>
        </div>
        
        <!-- Custom Create -->
        <div class="card bg-gradient-to-br from-green-500 to-teal-500 text-white shadow-xl">
            <div class="card-body text-center">
                <i class="fas fa-edit text-4xl mb-3"></i>
                <h3 class="card-title justify-center">Try your generated prompt</h3>
                <p>Try out your generated prompt with different AI models like GPT-4 and Gemini</p>
                <div class="card-actions justify-center mt-4">
                    <a href="/templates/create" class="btn btn-ghost text-white border-white hover:bg-white hover:text-green-500">
                        Create Now
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Enhanced stats loading and animations
document.body.addEventListener('htmx:beforeRequest', function(evt) {
    if (evt.detail.elt.id === 'stats-container') {
        // Show loading skeleton
        const loadingSkeleton = document.getElementById('stats-loading');
        const statsContainer = document.getElementById('stats-container');
        
        if (loadingSkeleton && statsContainer) {
            loadingSkeleton.style.display = 'grid';
            statsContainer.style.display = 'none';
        }
    }
});

// Handle successful stats loading
document.body.addEventListener('htmx:afterSwap', function(evt) {
    if (evt.detail.target.id === 'stats-container') {
        // Hide loading skeleton and show stats
        const loadingSkeleton = document.getElementById('stats-loading');
        const statsContainer = document.getElementById('stats-container');
        const statsSummary = document.getElementById('stats-summary');
        
        if (loadingSkeleton && statsContainer) {
            loadingSkeleton.style.display = 'none';
            statsContainer.style.display = 'grid';
            statsContainer.classList.add('fade-in');
            
            if (statsSummary) {
                statsSummary.style.display = 'block';
                statsSummary.classList.add('fade-in');
            }
        }
        
        // Animate numbers and progress bars
        animateStatsNumbers();
        animateProgressBars();
    }
});

// Handle stats loading errors
document.body.addEventListener('htmx:responseError', function(evt) {
    if (evt.detail.elt.id === 'stats-container') {
        const loadingSkeleton = document.getElementById('stats-loading');
        const statsContainer = document.getElementById('stats-container');
        
        if (loadingSkeleton && statsContainer) {
            loadingSkeleton.style.display = 'none';
            statsContainer.style.display = 'grid';
            statsContainer.innerHTML = `
                <div class="col-span-full text-center py-8">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Statistics temporarily unavailable. Please refresh to try again.</span>
                    </div>
                </div>
            `;
        }
    }
});

function animateStatsNumbers() {
    const numberElements = document.querySelectorAll('.number-animated');
    
    numberElements.forEach(el => {
        const finalValue = el.textContent;
        
        // Skip if not a number
        if (isNaN(parseInt(finalValue))) return;
        
        const finalNum = parseInt(finalValue.replace(/[^\d]/g, ''));
        let currentNum = 0;
        const increment = Math.ceil(finalNum / 50); // 50 steps
        const duration = 1500; // 1.5 seconds
        const stepTime = duration / 50;
        
        el.textContent = '0';
        
        const timer = setInterval(() => {
            currentNum += increment;
            if (currentNum >= finalNum) {
                currentNum = finalNum;
                clearInterval(timer);
                el.classList.add('updated');
                setTimeout(() => el.classList.remove('updated'), 300);
            }
            
            // Format the number back to original format
            if (finalValue.includes('K')) {
                el.textContent = (currentNum / 1000).toFixed(1) + 'K';
            } else if (finalValue.includes('M')) {
                el.textContent = (currentNum / 1000000).toFixed(1) + 'M';
            } else {
                el.textContent = currentNum.toString();
            }
        }, stepTime);
    });
}

function animateProgressBars() {
    const progressBars = document.querySelectorAll('.stat-progress-fill');
    
    progressBars.forEach((bar, index) => {
        const targetWidth = bar.style.width;
        bar.style.width = '0%';
        
        setTimeout(() => {
            bar.style.width = targetWidth;
        }, 200 + (index * 100)); // Stagger the animations
    });
}

// Handle recent templates loading
document.body.addEventListener('htmx:afterSwap', function(evt) {
    if (evt.detail.target.id === 'recent-templates') {
        // Recent templates loaded - could add animations here
        evt.detail.target.classList.add('fade-in');
    }
});

// Auto-refresh stats every 5 minutes
setInterval(() => {
    const statsContainer = document.getElementById('stats-container');
    if (statsContainer && !document.hidden) {
        htmx.trigger(statsContainer, 'refresh');
    }
}, 300000); // 5 minutes

// Refresh stats when page becomes visible again
document.addEventListener('visibilitychange', () => {
    if (!document.hidden) {
        const statsContainer = document.getElementById('stats-container');
        if (statsContainer) {
            htmx.trigger(statsContainer, 'refresh');
        }
    }
});
</script>
{% endblock %}